<!doctype html>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" />

<link rel="shortcut icon" href="./images/favicon.png" type="image/x-icon"/>
<link rel="stylesheet" href="./CSS/font.css">
<link rel="stylesheet" href="./CSS/xadmin.css">
<script type="text/javascript" src="./JS/jquery.min.js"></script>
<script type="text/javascript" src="./lib/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="./JS/xadmin.js"></script>

<style>
    xblock{
        margin-bottom: 0;
    }
    .layui-table-page{
        text-align: center;
    }
</style>

<script type="text/html" id="TableUtilBar">
    {{#  if(d.username === "1"){ }}
    <a class="layui-btn layui-btn-xs" lay-event="check">审核</a>
    {{#  } }}
    <a class="layui-btn layui-btn-xs" lay-event="showUser"><i class="layui-icon" style="margin-right: 0">&#xe66f;</i></a>
    <a class="layui-btn layui-btn-xs" lay-event="editUser"><i class="layui-icon" style="margin-right: 0">&#xe642;</i></a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delUser"><i class="layui-icon" style="margin-right: 0">&#xe640;</i></a>
</script>
<script>
    $(function () {
        $("#addUserBtn").bind("click", addUser);
        $("#delSelectedBtn").bind("click", delSelected);
        layui.use(["laydate","laytpl"], function () {
            var laytpl = layui.laytpl;
            var laydate = layui.laydate;
            laydate.render({
                elem:"#startDay"
            });
            laydate.render({
                elem:"#endDay"
            });
        });
        showUsersTable();
    });
    function showUsersTable() {
        layui.use("table", function () {
            var table = layui.table;
            table.render({
                elem: '#dataTable',
                height: "full-109",
                url: '/adminQueryUser',
                skin:"nob",
                even:true,
                page: {
                    layout: ['prev', 'page', 'next','refresh'],
                    groups: 3,
                    limit:16,
                    first: false,
                    last: false
                },
                cols: [[ //表头
                    {type:'numbers'},
                    {type:'checkbox'},
                    {field: 'name', title: '用户名' , sort:true , width:150},
                    {field: 'gender', title: '性别', sort: true , width:150},
                    {field: 'birthday', title: '生日', sort: true},
                    {field: 'tel', title: '电话', sort: true},
                    {field: 'email', title: '邮箱', sort: true},
                    {field: 'password', title: '密码', sort: true},
                    {title:'操作', fixed: 'right', width:150, align:'center', toolbar: '#TableUtilBar'}
                ]]
            });
        });
    }
    function delSelected() {
        layer.confirm('确认要删除吗?', function (index) {
            layer.msg('删除成功', {icon: 1});
        });
    }

    function addUser() {
        layer.open({
            type: 2,
            area: ['420px', '439px'],
            fix: false, //不固定
            maxmin: true,
            shadeClose: true,
            shade:0,
            title: "新增用户",
            content: "admin-member-add.html",
            end:function () {
                showUsersTable();
            }
        });
    }

    function showUser(title, url, id, w, h) {
        x_admin_show(title, url, w, h);
    }

    function editUser(title, url, id, w, h) {
        x_admin_show(title, url, w, h);
    }

    function disableUser(obj, id) {
        layer.confirm('确认要停用吗？', function (index) {
            //发异步把用户状态进行更改
            $(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" onClick="enableuser(this,id)" href="javascript:;" title="启用"><i class="layui-icon">&#xe62f;</i></a>');
            $(obj).parents("tr").find(".td-status").html('<span class="layui-btn layui-btn-disabled layui-btn-mini">已停用</span>');
            $(obj).remove();
            layer.msg('已停用!', {icon: 5, time: 1000});
        });
    }

    function enableuser(obj, id) {
        layer.confirm('确认要启用吗？', function (index) {
            //发异步把用户状态进行更改
            $(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" onClick="disableUser(this,id)" href="javascript:;" title="停用"><i class="layui-icon">&#xe601;</i></a>');
            $(obj).parents("tr").find(".td-status").html('<span class="layui-btn layui-btn-normal layui-btn-mini">已启用</span>');
            $(obj).remove();
            layer.msg('已启用!', {icon: 6, time: 1000});
        });
    }

    function delUser(obj, id) {
        layer.confirm('确认要删除吗？', function (index) {
            //发异步删除数据
            $(obj).parents("tr").remove();
            layer.msg('已删除!', {icon: 1, time: 1000});
        });
    }
</script>

<html lang="en">
<head>
    <title>Sisyphus-Admin</title>
</head>
<body class="layui-anim layui-anim-up">
<div class="x-body">
    <xblock>
        <form class="layui-form" style="display: inline-block">
            <input type="text" name="username" placeholder="请输入用户名" autocomplete="off" class="layui-input" style="width: 150px;display: inline-block">
            <button class="layui-btn"><i class="layui-icon">&#xe615;</i></button>
        </form>
        <a class="layui-btn layui-btn-small" style="line-height:30px;padding:3px 18px;float:right;margin-left: 10px"
           href="javascript:location.replace(location.href);">
            <i class="iconfont" style="line-height:30px">&#xe6aa;</i>
        </a>
        <button id="delSelectedBtn" name="delSelectedBtn" class="layui-btn layui-btn-danger" style="float: right"><i class="layui-icon">&#xe640;</i>删除</button>
        <button id="addUserBtn" name="addUserBtn" class="layui-btn" style="float: right"><i class="layui-icon">&#xe608;</i>添加</button>

    </xblock>
    <table id="dataTable"></table>
</div>
</body>

</html>